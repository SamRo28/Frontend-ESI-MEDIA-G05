trigger:
  - main

variables:
 -‚Å† group: 'SonarSecrets'

pool:
  name: 'Default'

steps:
# Instalar Node.js
- task: NodeTool@0
  inputs:
    versionSpec: '20.x'
  displayName: 'Instalar Node.js'

# Instalar Firebase CLI
- script: |
    npm install -g firebase-tools
  displayName: 'Instalar Firebase CLI'

- script: |
    cd esi-media
    sonar-scanner -Dsonar.host.url=$(SONAR_HOST_URL) -Dsonar.login=$(SONAR_TOKEN)
  displayName: 'Run SonarQube Analysis (CLI, Windows)'

# Build + Deploy Angular
- script: |
    cd esi-media
    npm install
    npm run build -- --configuration=production
    firebase deploy --only hosting --token $(FIREBASE_TOKEN)
  displayName: 'Compilar Angular y desplegar en Firebase Hosting'
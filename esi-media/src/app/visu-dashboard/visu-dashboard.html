<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">
          <img src="/EsiMedia icono sin fondo.png" alt="ESIMedia Logo" class="w-8 h-8">
          <span class="logo-text">EsiMedia</span>
        </div>
      </div>

      <nav class="nav-menu">
        <a routerLink="/dashboard" class="nav-link" 
           [class.active]="activeSection === 'inicio'" 
           (click)="handleNavSelect('inicio')">Inicio</a>
        <a routerLink="/dashboard/videos" class="nav-link" 
           [class.active]="activeSection === 'videos'" 
           (click)="handleNavSelect('videos')">Videos</a>
        <a routerLink="/dashboard/audios" class="nav-link" 
           [class.active]="activeSection === 'audios'" 
           (click)="handleNavSelect('audios')">Audios</a>
        <a routerLink="/dashboard/listas-publicas" class="nav-link" 
           [class.active]="activeSection === 'listas'" 
           (click)="handleNavSelect('listas')">Listas Públicas</a>
        <button
          type="button"
          class="nav-link nav-button"
          [class.active]="activeSection === 'favoritos'"
          (click)="toggleFavoritosView()" 
          [attr.aria-pressed]="mostrarFavoritos">
          Mis favoritos
        </button>
      </nav>

      <div class="user-section">
        <!-- Botón de filtro -->
        <app-content-filter 
          [contentType]="contentFilterType"
          (filtersApplied)="onFiltersApplied($event)"
          (filtersChanged)="onFiltersChanged($event)">
        </app-content-filter>
        
        <button class="user-profile" 
                (click)="toggleUserMenu()" 
                (keydown)="onUserProfileKeydown($event)" 
                [attr.aria-expanded]="showUserMenu"
                [attr.aria-label]="'Menú de usuario de ' + userName">
          <div class="user-avatar-container">
            <div [class]="getAvatarClasses()">{{ userInitial }}</div>
            <div class="avatar-indicator" *ngIf="mostrarListasPrivadas"></div>
          </div>
          <span class="user-name">{{ userName }}</span>
          <div class="dropdown-arrow" [class.rotated]="showUserMenu">▼</div>
        </button>
        
        <!-- Menú desplegable del usuario -->
        <div class="user-dropdown" *ngIf="showUserMenu" role="menu">
          <a routerLink="/perfil" class="dropdown-item" role="menuitem">
            <span class="dropdown-text">Cuenta</span>
          </a>
          <button class="dropdown-item" (click)="toggleListasPrivadas()" role="menuitem">
            <span class="dropdown-text">Ver mis listas privadas</span>
            <span class="dropdown-badge" *ngIf="mostrarListasPrivadas">●</span>
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item logout-item" (click)="logout()" role="menuitem">
            <span class="dropdown-text">Cerrar sesión</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <section class="dashboard-section">
      <div class="section-header">
        <h2 class="section-title">{{ mostrarListasPublicas ? 'Listas Públicas' : 'Contenido Multimedia' }}</h2>
        <div class="section-actions">
          <button class="btn-toggle-panel" (click)="toggleListasPrivadas()">
            {{ mostrarListasPrivadas ? 'Ocultar Listas' : 'Ver Mis Listas' }}
          </button>
        </div>
      </div>
      
      <div *ngIf="mostrarFavoritos" class="favorites-section">
        <div class="favorites-header">
          <h3 class="favorites-title">Mis favoritos</h3>
          <span *ngIf="favoritosLoading" class="favorites-loading">Cargando favoritos...</span>
        </div>
        <app-multimedia-list 
          [showHeader]="false" 
          [showTitle]="false" 
          [tipoForzado]="filtroTipo"
          [tagFilters]="currentTagFilters"
          [filtersObject]="{ specialMode: 'favorites', specialPayload: { contents: favoritos } }">
        </app-multimedia-list>
        <p *ngIf="!favoritosLoading && favoritos.length === 0" class="favorites-empty">
          Aún no has añadido ningún favorito. Marca contenido para tenerlo siempre a mano.
        </p>
      </div>
      <ng-container *ngIf="!mostrarFavoritos">
        <div *ngIf="mostrarListasPublicas" class="listas-publicas-section">
          <app-gestion-listas [modo]="'visualizador'" [forceReload]="forceReloadListasPublicas"></app-gestion-listas>
        </div>
        <div *ngIf="!mostrarListasPublicas">
          <app-multimedia-list 
            [showHeader]="false" 
            [showTitle]="false" 
            [tipoForzado]="filtroTipo"
            [tagFilters]="currentTagFilters"
            [filtersObject]="currentFiltersObject">
          </app-multimedia-list>
        </div>
      </ng-container>
    <!-- Panel lateral de listas privadas -->
    <aside class="listas-privadas-panel" *ngIf="mostrarListasPrivadas">
      <div class="panel-header">
        <h2 class="panel-title">Mis Listas Privadas</h2>
        <div class="panel-actions">
          <button class="btn-cerrar-panel" (click)="toggleListasPrivadas()">✕</button>
        </div>
      </div>
      <app-listas-privadas 
        [forceReload]="forceReloadListas"
        (abrirCrearModal)="openCrearListaModal()">
      </app-listas-privadas>
    </aside>
    </section>
  </main>

  <!-- Footer -->
  <footer class="dashboard-footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="#" class="footer-link">Acerca de</a>
        <a href="#" class="footer-link">Privacidad</a>
        <a href="#" class="footer-link">Términos</a>
        <a href="#" class="footer-link">Contacto</a>
      </div>
      <p class="footer-text">© 2025 EsiMedia. Todos los derechos reservados.</p>
    </div>
  </footer>
</div>

<!-- Modal para crear lista -->
<div class="modal-backdrop" *ngIf="showCrearModal" (click)="closeCrearListaModal()" (keydown)="$event.key === 'Escape' && closeCrearListaModal()"></div>
<dialog class="modal-container" [attr.open]="showCrearModal ? true : null">
  <crear-lista 
    [modo]="'visualizador'"
    [modal]="true"
    (cerrar)="closeCrearListaModal()"
    (creada)="closeCrearListaModal(true)">
  </crear-lista>
</dialog>

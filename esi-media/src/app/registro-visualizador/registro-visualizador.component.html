<!--
  RegistroVisualizadorComponent - Paso 1 (Scaffolding)
  Partes reproducidas de la captura:
  - Hero superior con gradiente oscuro y logo a la izquierda
  - Card centrada con fondo translúcido, título grande y subtítulo
  - Espacio reservado para logo/imagen en la parte superior de la card

  NOTAS: Aquí no hay formulario aún. Se añadirá en el Paso 2/3.
-->

<div class="gradient-bg"></div>

<div class="back-home">
  <a routerLink="/home" class="btn-back">← Volver al inicio</a>
</div>

<div class="login-container">
  <div class="login-card">
    <div class="login-header">
  <div class="logo-container"><div class="logo-login"></div></div>
      <h1 class="login-title">Registro Visualizador</h1>
      <p class="login-subtitle">Crea tu cuenta para descubrir música, podcasts y más</p>
    </div>

    <form class="login-form" [formGroup]="form" (ngSubmit)="onSubmit()">

  <div class="grid-two spaced name-pair">
        <div class="form-group">
          <label for="nombre" class="form-label">Nombre</label>
          <input id="nombre" class="form-input" type="text" formControlName="nombre" placeholder="Tu nombre" maxlength="40" [ngClass]="{'error-field': (formSubmitted && form.get('nombre')?.invalid) || form.get('nombre')?.hasError('server')}" />
        </div>

        <div class="form-group">
          <label for="apellidos" class="form-label">Apellidos</label>
          <input id="apellidos" class="form-input" type="text" formControlName="apellidos" placeholder="Tus apellidos" maxlength="60" [ngClass]="{'error-field': (formSubmitted && form.get('apellidos')?.invalid) || form.get('apellidos')?.hasError('server')}" />
        </div>
      </div>

      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input id="email" class="form-input" type="email" formControlName="email" placeholder="tu@email.com" [ngClass]="{'error-field': (formSubmitted && form.get('email')?.invalid) || form.get('email')?.hasError('server') || form.get('email')?.hasError('duplicate')}" />
      </div>

      <div class="form-group">
        <label for="alias" class="form-label">Alias (opcional)</label>
        <input id="alias" class="form-input" type="text" formControlName="alias" placeholder="alias" maxlength="12" [ngClass]="{'error-field': (formSubmitted && form.get('alias')?.invalid) || form.get('alias')?.hasError('server')}" />
      </div>

      <div class="form-group">
        <label for="fecha_nac" class="form-label">Fecha de nacimiento</label>
        <input id="fecha_nac" class="form-input" type="date" formControlName="fecha_nac" placeholder="aaaa-mm-dd" [attr.max]="todayStr" [attr.min]="minAllowedBirthStr" [ngClass]="{'error-field': (formSubmitted && form.get('fecha_nac')?.invalid) || form.get('fecha_nac')?.hasError('server')}" />
  <small class="hint" *ngIf="formSubmitted && form.get('fecha_nac')?.value && form.get('fecha_nac')?.invalid">No debe ser futura. Debes tener al menos 4 años.</small>
      </div>

  <div class="grid-two spaced pass-pair">
        <div class="form-group">
          <label for="password" class="form-label">Contraseña</label>
          <div class="password-input-container">
            <input id="password" class="form-input" [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="Contraseña" 
                  [ngClass]="{'error-field': (formSubmitted && form.get('password')?.invalid) || form.get('password')?.hasError('server')}" />
            <button type="button" class="password-toggle" (click)="showPassword = !showPassword" aria-label="Mostrar/ocultar contraseña">
              <span class="eye-icon">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path *ngIf="!showPassword" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path *ngIf="!showPassword" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                  <path *ngIf="showPassword" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18"></path>
                </svg>
              </span>
            </button>
          </div>
          
          <!-- Indicadores de requisitos de contraseña -->
          <div class="password-requirements" *ngIf="form.get('password')?.dirty || formSubmitted">
            <div class="requirement" [ngClass]="{'met': passwordValidation.minLength, 'unmet': !passwordValidation.minLength}">
              <span class="icon">{{ passwordValidation.minLength ? '✓' : '✗' }}</span>
              Al menos 8 caracteres
            </div>
            <div class="requirement" [ngClass]="{'met': passwordValidation.hasUpperCase, 'unmet': !passwordValidation.hasUpperCase}">
              <span class="icon">{{ passwordValidation.hasUpperCase ? '✓' : '✗' }}</span>
              Al menos una letra mayúscula
            </div>
            <div class="requirement" [ngClass]="{'met': passwordValidation.hasLowerCase, 'unmet': !passwordValidation.hasLowerCase}">
              <span class="icon">{{ passwordValidation.hasLowerCase ? '✓' : '✗' }}</span>
              Al menos una letra minúscula
            </div>
            <div class="requirement" [ngClass]="{'met': passwordValidation.hasNumber, 'unmet': !passwordValidation.hasNumber}">
              <span class="icon">{{ passwordValidation.hasNumber ? '✓' : '✗' }}</span>
              Al menos un número
            </div>
            <div class="requirement" [ngClass]="{'met': passwordValidation.hasSpecialChar, 'unmet': !passwordValidation.hasSpecialChar}">
              <span class="icon">{{ passwordValidation.hasSpecialChar ? '✓' : '✗' }}</span>
              Al menos un carácter especial
            </div>
            <div class="requirement" [ngClass]="{'met': !passwordValidation.hasPersonalData, 'unmet': passwordValidation.hasPersonalData}">
              <span class="icon">{{ !passwordValidation.hasPersonalData ? '✓' : '✗' }}</span>
              Sin datos personales
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="passwordConfirm" class="form-label">Confirmar contraseña</label>
          <div class="password-input-container">
            <input id="passwordConfirm" class="form-input" [type]="showConfirmPassword ? 'text' : 'password'" formControlName="passwordConfirm" placeholder="Repite la contraseña" 
                  [ngClass]="{'error-field': (formSubmitted && form.get('passwordConfirm')?.invalid) || form.get('passwordConfirm')?.hasError('server')}" />
            <button type="button" class="password-toggle" (click)="showConfirmPassword = !showConfirmPassword" aria-label="Mostrar/ocultar contraseña">
              <span class="eye-icon">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path *ngIf="!showConfirmPassword" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path *ngIf="!showConfirmPassword" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                  <path *ngIf="showConfirmPassword" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18"></path>
                </svg>
              </span>
            </button>
          </div>
        </div>
      </div>

      <div class="form-group vip-row">
        <label class="form-label" for="vip">VIP</label>
        <input id="vip" type="checkbox" formControlName="vip" />
      </div>

      <div class="form-group">
        <label class="form-label">Avatar de perfil</label>
        <div class="preloaded">
          <div class="thumbs">
            <img *ngFor="let img of preloadedImages; index as i" 
                [src]="'/' + img" 
                (click)="selectPreloaded(i)" 
                [ngClass]="{'selected-avatar': selectedAvatar === i}" 
                class="thumb" 
                alt="avatar" />
          </div>
        </div>
        <div class="preview" *ngIf="selectedAvatar !== -1">
          <img [src]="'/' + preloadedImages[selectedAvatar]" alt="preview" class="preview-img" />
          <button type="button" class="btn remove-btn" (click)="removePreview()">Quitar selección</button>
        </div>
      </div>

      <div class="error-block" aria-live="polite" [style.display]="aggregatedErrors.length ? 'block' : 'none'">
        <ul>
          <li *ngFor="let e of aggregatedErrors">{{ e }}</li>
        </ul>
      </div>

      <div class="actions">
        <button class="btn-submit" type="submit">Registrarme</button>
      </div>

    </form>
  </div>
</div>

<!-- Comentarios de diseño:
  - .hero reproduce el gradiente superior de la captura (oscuro -> violeta)
  - .card usa fondo translúcido y bordes redondeados como la tarjeta central
  - .card-image es un placeholder para el logo/imagen grande
-->

<div class="detalle-wrapper">
  <!-- Loader -->
  <div class="loader" *ngIf="cargando && !detalle">Cargando...</div>

  <!-- Error general -->
  <div class="error-banner" *ngIf="!cargando && error">{{ error }}</div>

  <div class="detalle" *ngIf="!cargando && detalle">
    <div class="cabecera">
      <div class="caratula" *ngIf="caratulaUrl()" [style.background-image]="'url(' + caratulaUrl() + ')'">
        <div class="vip-badge" *ngIf="detalle!.vip">VIP</div>
      </div>
      <div class="cabecera-info">
        <h1 class="titulo">{{ detalle!.titulo }}</h1>
        <p class="descripcion" *ngIf="detalle!.descripcion">{{ detalle!.descripcion }}</p>
        <div class="meta" *ngIf="duracion() || tags().length">
          <span class="chip" *ngIf="duracion()">⏱ {{ duracion() }}s</span>
          <span class="chip" *ngFor="let tag of tags()">#{{ tag }}</span>
        </div>
      </div>
    </div>

    <!-- VIDEO -->
    <div *ngIf="detalle!.tipo === 'VIDEO'" class="player-card">
      <video controls [src]="detalle!.referenciaReproduccion" class="video-player"></video>
      <p class="fallback">
        ¿Problemas? <a [href]="detalle!.referenciaReproduccion" target="_blank" rel="noopener">Abrir en pestaña nueva</a>.
      </p>
    </div>

    <!-- AUDIO (carga diferida) -->
    <div *ngIf="detalle!.tipo === 'AUDIO'" class="player-card">
      <div *ngIf="!audioUrl && !audioCargando && !audioError" class="deferred">
        <button class="retry-btn" (click)="descargarAudio()">Cargar audio</button>
      </div>
      <ng-container *ngIf="audioCargando">
        <div class="audio-loader">Descargando audio...</div>
      </ng-container>
      <ng-container *ngIf="audioUrl && !audioCargando && !audioError">
        <audio controls [src]="audioUrl"></audio>
      </ng-container>
      <div class="audio-error" *ngIf="audioError">
        {{ audioError }}
        <button class="retry-btn" (click)="reintentarAudio()">Reintentar</button>
      </div>
    </div>
  </div>
</div>

<div class="gestion-listas-container">
  <h2>GestiÃ³n de Listas</h2>

  <!-- Mostrar mensajes de Ã©xito o error -->
  <div *ngIf="mensajeExito" class="alert alert-success">
    {{ mensajeExito }}
  </div>
  <div *ngIf="mensajeError" class="alert alert-error">
    {{ mensajeError }}
  </div>

  <!-- BotÃ³n para navegar a crear lista -->
  <div class="crear-container">
    <button class="btn btn-primary" (click)="navegarACrearLista()">
      <span class="icon">+</span>
      Nueva Lista
    </button>
  </div>

  <!-- Formulario de ediciÃ³n (sÃ³lo aparece cuando se estÃ¡ editando) -->
  <div class="card formulario-section" *ngIf="listaEditando">
    <div class="card-header">
      <h3 class="card-title">
        <span class="icon">âœï¸</span>
        Editar Lista
      </h3>
    </div>
    
    <div class="card-content">
      <form [formGroup]="listaForm" (ngSubmit)="guardarLista()">
        <div class="form-field">
          <label for="nombre">Nombre *</label>
          <input 
            id="nombre"
            type="text"
            formControlName="nombre"
            placeholder="Nombre de la lista"
            class="full-width"
          />
          <small class="error" *ngIf="listaForm.get('nombre')?.hasError('required') && listaForm.get('nombre')?.touched">
            El nombre es obligatorio
          </small>
          <small class="error" *ngIf="listaForm.get('nombre')?.hasError('minlength') && listaForm.get('nombre')?.touched">
            El nombre debe tener al menos 3 caracteres
          </small>
        </div>

        <div class="form-field">
          <label for="descripcion">DescripciÃ³n *</label>
          <textarea 
            id="descripcion"
            formControlName="descripcion"
            rows="3"
            placeholder="Describe tu lista..."
            class="full-width"
          ></textarea>
          <small class="error" *ngIf="listaForm.get('descripcion')?.hasError('required') && listaForm.get('descripcion')?.touched">
            La descripciÃ³n es obligatoria
          </small>
          <small class="error" *ngIf="listaForm.get('descripcion')?.hasError('minlength') && listaForm.get('descripcion')?.touched">
            La descripciÃ³n debe tener al menos 10 caracteres
          </small>
        </div>

        <div class="checkbox-section" *ngIf="modo === 'gestor'">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="visible">
            Hacer lista pÃºblica
          </label>
          <small class="hint">Las listas pÃºblicas son visibles para otros usuarios</small>
        </div>

        <div class="form-field">
          <label for="tagsInput">Etiquetas</label>
          <input 
            id="tagsInput"
            type="text"
            formControlName="tagsInput"
            placeholder="rock, pop, indie"
            class="full-width"
          />
          <small class="hint">Separadas por comas</small>
        </div>

        <div class="form-group">
          <span class="contenidos-label">Contenidos en la lista: {{ contenidosCount }}</span>
          <div class="contenidos-list" *ngIf="contenidosIds.length > 0">
            <div *ngFor="let contenidoId of contenidosIds" class="contenido-item">
              <span>ID: {{ contenidoId }}</span>
              <button 
                class="btn btn-danger btn-small"
                (click)="quitarContenido(contenidoId)"
                title="Eliminar contenido"
              >
                <span class="icon">ğŸ—‘ï¸</span>
              </button>
            </div>
          </div>
          <div *ngIf="contenidosIds.length === 0" class="empty-state">
            No hay contenidos en esta lista
          </div>
        </div>

        <div class="form-actions">
          <button 
            class="btn btn-primary"
            type="submit"
            [disabled]="listaForm.invalid || guardando"
          >
            <span class="icon" *ngIf="guardando">â³</span>
            <span class="icon" *ngIf="!guardando">âœï¸</span>
            {{ guardando ? 'Guardando...' : 'Actualizar' }}
          </button>
          <button 
            class="btn btn-secondary"
            type="button"
            (click)="cancelarEdicion()"
          >
            <span class="icon">âŒ</span>
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Listado de listas existentes -->
  <div class="listas-section">
    <h3>Mis Listas ({{ listas.length }})</h3>
    
    <div *ngIf="cargando" class="loading">
      <div class="spinner"></div>
      <p>Cargando listas...</p>
    </div>

    <div *ngIf="!cargando && listas.length === 0" class="empty-state">
      No tienes listas creadas. Â¡Crea tu primera lista!
    </div>

    <div class="listas-grid" *ngIf="!cargando && listas.length > 0">
      <div *ngFor="let lista of listas" class="card lista-card">
        <div class="card-header">
          <h4 class="card-title">{{ lista.nombre }}</h4>
          <div class="card-subtitle">
            <span class="chip" [ngClass]="lista.visible ? 'chip-primary' : 'chip-secondary'">
              <span class="icon">{{ lista.visible ? 'ğŸŒ' : 'ğŸ”’' }}</span>
              {{ lista.visible ? 'PÃºblica' : 'Privada' }}
            </span>
          </div>
        </div>
        
        <div class="card-content">
          <p class="lista-descripcion">{{ lista.descripcion }}</p>
          
          <div class="lista-meta">
            <div class="meta-item">
              <span class="icon">ğŸ“</span>
              <span>{{ lista.contenidosIds?.length || 0 }} contenidos</span>
            </div>
            <div class="meta-item" *ngIf="lista.tags && lista.tags.length > 0">
              <span class="icon">ğŸ·ï¸</span>
              <span>{{ lista.tags.join(', ') }}</span>
            </div>
          </div>

          <div class="lista-dates" *ngIf="lista.fechaCreacion">
            <span class="icon">â°</span>
            <small>Creada: {{ formatDate(lista.fechaCreacion) }}</small>
          </div>
        </div>

        <div class="card-actions">
          <button 
            class="btn btn-primary"
            (click)="editarLista(lista)"
            title="Editar lista"
          >
            <span class="icon">âœï¸</span>
            Editar
          </button>
          <button 
            class="btn btn-danger"
            (click)="eliminarLista(lista.id!)"
            title="Eliminar lista"
          >
            <span class="icon">ğŸ—‘ï¸</span>
            Eliminar
          </button>
          <button 
            class="btn btn-success"
            (click)="mostrarAgregarContenido(lista)"
            title="AÃ±adir contenido"
          >
            <span class="icon">â•</span>
            Contenido
          </button>
        </div>
      </div>
    </div>
  </div>


</div>